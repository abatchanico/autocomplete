(function(f){var c=["enable","disable","flushCache","trigger","display","close"],b=this,d="autocomplete";var e={ajax:{url:document.URL,type:"POST",dataType:"json",data:{}},cb:{populate:null,process:null,preselect:null,select:null,unselect:null},width:"auto",delay:250,name:null,minLength:1,cache:true,once:false,filter:false,source:null,prefix:true,splitChr:null,autohide:false,loop:true,className:d};function g(h){var i;if(f.isArray(h)){i=[];f.each(h,function(j,k){i.push(k)})}else{if(typeof(h)==="object"){i=f.extend(true,{},h)}else{i=h}}return i}function a(q){var r={},j,m,o,i=-1,s=0,h={},k=false,n=false,p=this,l={key:function(t){p.key.apply(p,[t])},focusout:function(t){if(!f(this).data(d+"-focus")){p.hide(true)}},dblclick:function(){if(!o){p.updateTOComplete()}}};this.init=function(t){r=f.extend(true,{},e,t);if(typeof(r.source)==="string"){r.source=this.splitData(r.source)}if(t&&(typeof(t)==="object")&&(typeof(t.once)!=="undefined")&&t.once){if(typeof(t.filter)==="undefined"){r.filter=true}}q.attr("autocomplete","off");this.bind()};this.splitData=function(t){if(r.splitChr){return t.split(r.splitChr)}else{return t.split(/\r\n|\r|\n/)}};this.getSource=function(t){if(typeof(t)==="function"){return this.getSource.apply(this,[t.apply(q,[q.val()])])}else{if(typeof(t)==="string"){return this.splitData(t)}}return t};this.flush=function(){h={}};this.bind=function(){if(!k){q[f.browser.opera?"keypress":"keydown"](l.key);q.focusout(l.focusout);q.dblclick(l.dblclick);k=true}};this.unbind=function(){if(k){q.unbind(f.browser.opera?"keypress":"keydown",l.key);q.unbind("focusout",l.focusout);q.unbind("dblclick",l.dblclick);k=false}};this.updateToAutoHide=function(){if(!r.autohide){return}this.stopToAutoHide();m=setTimeout(function(){p.hide(p,[true])},r.autohide)};this.stopToAutoHide=function(){if(m){clearTimeout(m);m=null}};this.updateTOComplete=function(t){var u=this;clearTimeout(j);j=setTimeout(function(){u.complete.apply(u,[])},t?0:r.delay)};this.hover=function(u,t){var v=o?f("li",o).eq(u):null;if(v){v[(t?"add":"remove")+"Class"]("hover");if(t){this.scroll(v)}}};this.scroll=function(t){var w=o.scrollTop(),u=o.innerHeight(),x=t.position().top,v=t.outerHeight();if(x<0){n=true;o.scrollTop(w+x)}else{if(x+v>u){n=true;o.scrollTop(w+x-u+v)}}};this.getPageUpDownItem=function(t){if(!o){return false}var w=o.innerHeight(),u=0,v=i;f("li",o).each(function(z,y){var x=f(y);u+=(x.position().top>=0)&&(x.position().top+x.outerHeight()<=w)?1:0});if(i<0){return(t?s:u)-1}v+=t?-u:u;v=Math.max(0,v);v=Math.min(v,s-1);if(r.loop&&(v==i)){v=v===0?s-1:0}return v};this.key=function(u){var v=u.keyCode,t;if(v===9){}else{if(!o&&(v!==27)&&(v!==13)){this.updateTOComplete()}else{if((v===38)||(v===40)){t=i+(v===38?-1:1);if(r.loop){if(t<0){t=s-1}else{if(t>s-1){t=0}}}t=Math.max(0,t);t=Math.min(t,s-1);this.preselect(t);u.preventDefault()}else{if((v===33)||(v===34)){t=this.getPageUpDownItem(v===33);if(t!==false){this.preselect(t)}u.preventDefault()}else{if(v===13){if(i!==-1){this.select(i,f("li",o).eq(i).text());u.preventDefault();u.stopImmediatePropagation()}else{this.hide(true)}}else{if(v===27){this.preselect(-1);this.hide(true)}else{this.updateTOComplete()}}}}}}};this.data=function(){var u,t="value";if(typeof(r.cb.populate)==="function"){u=f.extend(true,{},r.ajax.data,r.cb.populate.apply(q,[]))}else{u=f.extend(true,{},r.ajax.data);if(r.name&&r.name.length){t=r.name}else{if(q.attr("name")&&q.attr("name").length){t=q.attr("name")}else{if(q.attr("id")&&q.attr("id").length){t=q.attr("id")}}}u[t]=q.val()}return u};this.complete=function(){var t=q.val();if(r.minLength&&(r.minLength>t.length)){if(this.hide(true)){this.preselect(-1)}return}if(r.source){this.completeSource()}else{this.completeAjax()}};this.filterData=function(w){var u=new RegExp((r.prefix?"^":"")+q.val().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),v=[],t;for(t=0;t<w.length;t++){if(u.test(w[t])){v.push(w[t])}}return v};this.completeSource=function(){this.show(this.getSource(r.source),true)};this.completeAjax=function(){var u=this,w=q.val(),t;if(h&&((r.once&&!f.isEmptyObject(h))||(r.cache&&(typeof(h[w])!=="undefined")))){var v=r.once?g(h):g(h[w]);if(typeof(r.cb.process)==="function"){v=r.cb.process.apply(q,[v,r.once?"once":"cache"])}if(typeof(v)==="string"){v=u.splitData(v)}this.show(v,r.filter);return}t=f.extend(true,{},r.ajax);t.success=function(y,z,x){if(r.once){h=g(y)}else{if(r.cache){h[w]=g(y)}}if(typeof(r.cb.process)==="function"){y=r.cb.process.apply(q,[y,z,x])}if(typeof(y)==="string"){y=u.splitData(y)}u.show.apply(u,[y,r.filter])};t.data=this.data();f.ajax(t)};this.preselect=function(t){this.updateToAutoHide();if(i===t){return}this.hover(i,false);i=t;this.hover(i,true);if(typeof(r.cb.preselect)==="function"){r.cb.preselect.apply(q,[i])}};this.select=function(t,u){this.stopToAutoHide();if(u===null){u=q.val()}else{q.val(u)}this.hide();if(typeof(r.cb.select)==="function"){r.cb.select.apply(q,[u,t])}};this.show=function(x,u){var w=this,t=q.position(),v=f.browser.msie?q.outerWidth():q.width();this.hide();if(!x||(typeof(x)!=="object")||!x.length){return}if((typeof(u)==="undefined"&&r.filter)||u){x=this.filterData(x)}o=f('<ul class="'+r.className+'"></ul>').css("position","absolute").css("left",t.left+"px").css("top",(t.top+q.outerHeight())+"px").scroll(function(){n=false});if(r.width==="auto"){o.css(f.browser.msie?"width":"minWidth",v+"px")}else{if(r.width===false){o.css("width",v+"px").css("overflow","hidden")}else{o.css("width",r.width).css("overflow","hidden")}}i=-1;s=x.length;f.each(x,function(y,A){var B=f("<li></li>"),z=f("<a></a>");z.click(function(){w.select.apply(w,[y,A])});B.hover(function(){if(!n){w.preselect(y)}});o.append(B.append(z.append(A)))});o.hover(function(){q.data(d+"-focus",true);w.stopToAutoHide()},function(){q.data(d+"-focus",false);w.updateToAutoHide();if(!q.is(":focus")){q.trigger("focusout")}});q.after(o);if(f.browser.msie){f.each("min max".split(" "),function(z,y){f.each("Width Height".split(" "),function(C,A){var B=parseInt(o.css(y+A));if(!isNaN(B)&&((o[A.toLowerCase()]()<B)^z)){o.css(A.toLowerCase(),B+"px")}})})}this.updateToAutoHide()};this.reverse=function(u){var t=null;f("li",o).each(function(w,v){if((t===null)&&(f(v).text()===u)){t=w}});return t};this.hide=function(u){if(o){if(u){var v=q.val(),t=!v.length||(r.minLength&&(r.minLength>v.length))?null:this.reverse(v);if(t!==null){this.select(t);return}else{if(typeof(r.cb.unselect)==="function"){r.cb.unselect.apply(q,[v])}}}this.stopToAutoHide();o.remove();o=null;i=-1;return true}return false};this.isPublic=function(t){for(var u=0;u<c.length;u++){if(c[u]===t){return true}}return false};this.process=function(){var v=[];for(var t=0;t<arguments.length;t++){v.push(arguments[t])}if(v.length&&typeof(v[0])==="string"){var u=v.shift();if(this.isPublic(u)){this[u].apply(this,v)}}else{this.init.apply(this,v)}}}a.prototype.flushCache=function(){this.flush()};a.prototype.enable=function(){this.bind()};a.prototype.disable=function(){this.unbind();this.preselect(-1);this.hide()};a.prototype.trigger=function(){this.updateTOComplete(true)};a.prototype.display=function(h,i){this.show(this.getSource(h),i)};a.prototype.close=function(){this.hide()};f.fn.autocomplete=function(){var h=arguments;f.each(this,function(){var j=f(this),i=j.data(d);if(!i){i=new a(j);j.data(d,i)}i.process.apply(i,h)});return this}}(jQuery));